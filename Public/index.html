<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <meta http-equiv="refresh" content="2"> -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;648&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />


  <title>Vovinam Tranh Cúp Cóc Vàng</title>
</head>

<body>
  <div class="button-group">
    <button id="loginGoogle">Google Login</button>
    <button id="logout">Logout</button>
    <button id="loginEmail">Email Login</button>
  </div>
  <div class="form-container" id="myForm">
    <h1>Login</h1>

    <label for="email"><b>Email</b></label>
    <input type="text" placeholder="Enter Email" id="email" required>

    <label for="psw"><b>Password</b></label>
    <input type="password" placeholder="Enter Password" id="password" required>

    <button type="button" class="btn" id="loginEmailPopup">Login</button>
    <button type="button" class="btn cancel" id="closeForm">Cancel</button>
  </div>
  <!-- <a href="./suathongtin.html" target="_blank"> -->
  <div class="body">
    <div class="text">
      <!-- <div>
        <span id="noidung"></span>
      </div> -->
      <div class="text-mid">
        <span id="tongdiem">...</span>
        điểm
      </div>
      <div class="text-bottom">
        <table class="giamdinh-table">
          <tr>
            <td>Điểm GĐ 1</td>
            <td>Điểm GĐ 2</td>
            <td>Điểm GĐ 3</td>
          </tr>
          <tr class="diem-table">
            <td><span id="giamdinh1" class="giamdinh"></span></td>
            <td><span id="giamdinh2" class="giamdinh"></span></td>
            <td><span id="giamdinh3" class="giamdinh"></span></td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <!-- </a> -->

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get, set, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js'
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCPlKZds5tvDwU4hKUp_GGU2D1nc1biDtQ",
      authDomain: "olympicquynhoncampus.firebaseapp.com",
      projectId: "olympicquynhoncampus",
      storageBucket: "olympicquynhoncampus.appspot.com",
      messagingSenderId: "758747044525",
      appId: "1:758747044525:web:2fbc9000e189632f9c0424",
      databaseURL: "https://olympicquynhoncampus-default-rtdb.asia-southeast1.firebasedatabase.app",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth();
    const providerGoogle = new GoogleAuthProvider()

    const loginGoogleButton = document.getElementById('loginGoogle')
    loginGoogleButton.onclick = async () => {
      signInWithPopup(auth, providerGoogle)
        .then((result) => {
          const user = result.user
          // console.log(user);
        }).catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message
          console.log(error);
        })
    }
    const emailLoginForm = document.getElementById("myForm");
    emailLoginForm.style.display = 'none'
    const loginEmailButton = document.getElementById('loginEmail')
    loginEmailButton.onclick = async () => {
      emailLoginForm.style.display = "block";
    }
    const loginEmailClose = document.getElementById('closeForm')
    loginEmailClose.onclick = async () => {
      emailLoginForm.style.display = "none";
    }

    const loginEmailPopup = document.getElementById('loginEmailPopup');
    loginEmailPopup.onclick = function () {
      let email = document.getElementById('email').value;
      if (email) {
        let password = document.getElementById('password').value;

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            // Signed in 
            const user = userCredential.user;
            // console.log(user);
            // ...
          })
          .catch((error) => {
            console.log(error);
          });
      }
    }


    const logoutButton = document.getElementById('logout');
    logoutButton.style.display = 'none'
    logoutButton.onclick = async () => {
      signOut(auth).then(() => {
        console.log("You have signed out successfully!");
      }).catch((error) => { })
    }


    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log(user);
        loginGoogleButton.style.display = "none";
        loginEmailButton.style.display = "none";
        logoutButton.style.display = "";
        emailLoginForm.style.display = "none";
      } else {
        loginGoogleButton.style.display = "";
        loginEmailButton.style.display = "";
        logoutButton.style.display = "none";
      }
    })




    let noidung = document.getElementById("noidung");
    // ref(db, "diem/").once('value').then((snapshot) => {
    //   console.log(snapshot);
    // })

    onValue(ref(db, "diem/"), (snapshot) => {
      if (snapshot.exists()) {
        const giamdinh1 = snapshot.val().giamdinh1;
        const giamdinh2 = snapshot.val().giamdinh2;
        const giamdinh3 = snapshot.val().giamdinh3;
        let tongdiem = document.getElementById("tongdiem");
        let giamdinh1Table = document.getElementById("giamdinh1");
        let giamdinh2Table = document.getElementById("giamdinh2");
        let giamdinh3Table = document.getElementById("giamdinh3");
        if (giamdinh1 && giamdinh2 && giamdinh3) {
          const tongdiemRounded = giamdinh1 - -giamdinh2 - -giamdinh3;
          document.getElementsByClassName("text")[0].style.display = "block";
          tongdiem.innerHTML = tongdiemRounded;
          giamdinh1Table.innerHTML = giamdinh1;
          giamdinh2Table.innerHTML = giamdinh2;
          giamdinh3Table.innerHTML = giamdinh3;
        } else {
          tongdiem.innerHTML = '...';
          giamdinh.innerHTML = '...';
        }
      } else {
        console.log("No data found");
        document.getElementsByClassName("text")[0].style.display = "none";
      }
    })

  </script>
</body>

</html>